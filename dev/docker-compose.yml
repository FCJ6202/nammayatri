version: "3"
services:
  app-db:
    image: "postgres:12.3"
    container_name: "atlas-app"
    ports:
      - "5433:5432"
    volumes:
      - ./sql-seed/app-backend-seed.sql:/docker-entrypoint-initdb.d/app-backend-seed.sql:Z
    environment:
      - POSTGRES_DB=atlas_app
      - POSTGRES_USER=atlas
      - POSTGRES_PASSWORD=atlas
      - POSTGRES_HOST_AUTH_METHOD=scram-sha-256
      - POSTGRES_INITDB_ARGS=--auth=scram-sha-256
  transporter-db:
    image: "postgres:12.3"
    container_name: "atlas-transporter"
    ports:
      - "5434:5432"
    volumes:
      - ./sql-seed/transporter-backend-seed.sql:/docker-entrypoint-initdb.d/transporter-backend-seed.sql:Z
    environment:
      - POSTGRES_DB=atlas_transporter
      - POSTGRES_USER=atlas
      - POSTGRES_PASSWORD=atlas
      - POSTGRES_HOST_AUTH_METHOD=scram-sha-256
      - POSTGRES_INITDB_ARGS=--auth=scram-sha-256
  gateway-db:
    image: "postgres:12.3"
    container_name: "atlas-gateway"
    ports:
      - "5435:5432"
    volumes:
      - ./sql-seed/gateway-backend-seed.sql:/docker-entrypoint-initdb.d/gateway-backend-seed.sql:Z
    environment:
      - POSTGRES_DB=atlas_gateway
      - POSTGRES_USER=atlas
      - POSTGRES_PASSWORD=atlas
      - POSTGRES_HOST_AUTH_METHOD=scram-sha-256
      - POSTGRES_INITDB_ARGS=--auth=scram-sha-256
  fmd-wrapper-db:
    image: "postgres:12.3"
    container_name: "atlas-fmd-wrapper"
    ports:
      - "5436:5432"
    volumes:
      - ./sql-seed/fmd-wrapper-backend-seed.sql:/docker-entrypoint-initdb.d/fmd-wrapper-backend-seed.sql:Z
    environment:
      - POSTGRES_DB=atlas_fmd_wrapper
      - POSTGRES_USER=atlas
      - POSTGRES_PASSWORD=atlas
      - POSTGRES_HOST_AUTH_METHOD=scram-sha-256
      - POSTGRES_INITDB_ARGS=--auth=scram-sha-256
  mock-app-db:
    image: "postgres:12.3"
    container_name: "atlas-mock-app"
    ports:
      - "5437:5432"
    volumes:
      - ./sql-seed/mock-app-backend-seed.sql:/docker-entrypoint-initdb.d/mock-app-backend-seed.sql:Z
    environment:
      - POSTGRES_DB=atlas_mock_app_backend
      - POSTGRES_USER=atlas
      - POSTGRES_PASSWORD=atlas
      - POSTGRES_HOST_AUTH_METHOD=scram-sha-256
      - POSTGRES_INITDB_ARGS=--auth=scram-sha-256
  mock-provider-db:
    image: "postgres:12.3"
    container_name: "atlas-mock-provider"
    ports:
      - "5438:5432"
    volumes:
      - ./sql-seed/mock-provider-backend-seed.sql:/docker-entrypoint-initdb.d/mock-provider-backend-seed.sql:Z
    environment:
      - POSTGRES_DB=atlas_mock_provider_backend
      - POSTGRES_USER=atlas
      - POSTGRES_PASSWORD=atlas
      - POSTGRES_HOST_AUTH_METHOD=scram-sha-256
      - POSTGRES_INITDB_ARGS=--auth=scram-sha-256
  transporter-redis:
    image: "redis:5"
    ports:
      - "6379:6379"
  passetto-db:
    image: "postgres:12.3"
    container_name: "passetto-enc-db"
    ports:
      - "5422:5432"
    volumes:
      - ./sql-seed/passetto-seed.sql:/docker-entrypoint-initdb.d/create_schema.sql:Z
    environment:
      - POSTGRES_DB=passetto
      - POSTGRES_USER=passetto
      - POSTGRES_PASSWORD=passetto
      - POSTGRES_HOST_AUTH_METHOD=scram-sha-256
      - POSTGRES_INITDB_ARGS=--auth=scram-sha-256
  passetto-server:
    image: "juspayin/passetto-hs:0b18530"
    container_name: "passetto-enc-server"
    command: demo  # for DEV only
    ports:
      - "8021:8012"
    environment:
      - "PASSETTO_PG_BACKEND_CONN_STRING=postgresql://passetto:passetto@passetto-enc-db:5432/passetto"
