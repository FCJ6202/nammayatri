imports:
  Text: Data.Text
  APISuccess: Kernel.Types.APISuccess
  LatLong: Kernel.External.Maps.Types
  ServiceTierType: Domain.Types.Common
  ToParamSchema: Kernel.Prelude
  ApprovalRequestData: Domain.Types.ApprovalRequest
  TripStatus: Domain.Types.TripTransaction
  TripTransaction: Domain.Types.TripTransaction
  ApprovalRequest: Domain.Types.ApprovalRequest

module: WMB

types:
  RouteInfo:
    code: Text
    shortName: Text
    longName: Text
    startPoint: LatLong
    endPoint: LatLong

  AvailableRoute:
    routeInfo: RouteInfo
    source: StopInfo
    destination: StopInfo
    vehicleDetails: VehicleDetails

  StopInfo:
    name: Text
    code: Text
    point: LatLong

  VehicleDetails:
    number: Text
    _type: ServiceTierType

  TripLinkReq:
    vehicleNumberHash: Text
    routeCode: Text
    location: LatLong

  TripTransactionDetails:
    tripTransactionId: Id TripTransaction
    vehicleNum: Text
    vehicleType: ServiceTierType
    source: StopInfo
    destination: StopInfo
    status: TripStatus
    routeInfo: RouteInfo

  ActiveTripTransaction:
    tripTransactionDetails: Maybe TripTransactionDetails

  EndTripStatus:
    enum: "SUCCESS,WAITING_FOR_ADMIN_APPROVAL"

  TripStartReq:
    location: LatLong

  TripEndReq:
    location: LatLong

  TripEndResp:
    requestId: Maybe Text
    result: EndTripStatus

  RequestDetails:
    requestData: ApprovalRequestData
    title: Text
    body: Text

  DriverReqResp:
    requestId: Text

  AvailableRouteReq:
    vehicleNumber: Text

apis:
  - GET:
      endpoint: /wmb/availableRoutes
      auth: TokenAuth PROVIDER_TYPE
      request:
        type: AvailableRouteReq
      response:
        type: "[AvailableRoute]"
  - POST:
      endpoint: /wmb/trip/link
      auth: TokenAuth PROVIDER_TYPE
      request:
        type: TripLinkReq
      response:
        type: TripTransactionDetails

  - GET:
      endpoint: /wmb/trip/active
      auth: TokenAuth PROVIDER_TYPE
      response:
        type: ActiveTripTransaction

  - GET:
      endpoint: /wmb/trip/list
      auth: TokenAuth PROVIDER_TYPE
      query:
        - limit: Int
        - offset: Int
        - status: TripStatus
      response:
        type: "[TripTransactionDetails]"

  - POST:
      endpoint: /wmb/trip/{tripTransactionId}/start
      auth: TokenAuth PROVIDER_TYPE
      params:
        tripTransactionId: Id TripTransaction
      request:
        type: TripStartReq
      response:
        type: APISuccess

  - POST:
      endpoint: /wmb/trip/{tripTransactionId}/end
      auth: TokenAuth PROVIDER_TYPE
      params:
        tripTransactionId: Id TripTransaction
      request:
        type: TripEndReq
      response:
        type: TripEndResp

  - POST:
      endpoint: /wmb/trip/{tripTransactionId}/request
      auth: TokenAuth PROVIDER_TYPE
      params:
        tripTransactionId: Id TripTransaction
      request:
        type: RequestDetails
      response:
        type: DriverReqResp
  - POST:
      endpoint: /wmb/requests/{approvalRequestId}/cancel
      auth: TokenAuth PROVIDER_TYPE
      params:
        approvalRequestId: Id ApprovalRequest
      response:
        type: APISuccess
