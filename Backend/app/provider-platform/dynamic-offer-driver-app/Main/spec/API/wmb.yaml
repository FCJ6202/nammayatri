imports:
  Text: Data.Text
  APISuccess: Kernel.Types.APISuccess
  LatLong: Kernel.External.Maps.Types
  ServiceTierType: Domain.Types.Common
  ToParamSchema: Kernel.Prelude
  RequestType: Domain.Types.ApprovalRequest
  TripStatus: Domain.Types.TripTransaction

module: WMB

types:
  RouteInfo:
    code: Text
    shortName: Text
    longName: Text
    startPoint: LatLong
    endPoint: LatLong

  AvailableRoute:
    routeInfo: RouteInfo
    source: StopInfo
    destination: StopInfo
    vehicleDetails: VehicleDetails

  StopInfo:
    name: Text
    code: Text
    lat: Maybe Double
    long: Maybe Double

  VehicleDetails:
    number: Text
    _type: ServiceTierType

  TripLinkReq:
    vehicleNumberHash: Text
    routeCode: Text

  TripTransactionDetailsExtra:
    tripTransactionId: Text
    vehicleNum: Text
    vehicleType: ServiceTierType
    source: StopInfo
    destination: StopInfo
    status: TripStatus
    routeInfo: RouteInfo

  ActiveTripTransaction:
    tripTransactionDetails: Maybe TripTransactionDetailsExtra

  TripTransactionDetails:
    tripTransactionId: Text
    vehicleNum: Text
    vehicleType: ServiceTierType
    source: StopInfo
    destination: StopInfo

  EndTripStatus:
    enum: "SUCCESS,WAITING_FOR_ADMIN_APPROVAL"

  TripStartReq:
    location: LatLong

  TripEndReq:
    location: LatLong

  TripEndResp:
    requestId: Maybe Text
    result: EndTripStatus

  RequestDetails:
    requestType: RequestType
    title: Text
    body: Text
    lat: Double
    lon: Double

  DriverReqResp:
    requestId: Text

  AvailableRouteReq:
    vehicleNumber: Text

apis:
  - GET:
      endpoint: /wmb/availableRoutes
      auth: TokenAuth PROVIDER_TYPE
      request:
        type: AvailableRouteReq
      response:
        type: "[AvailableRoute]"
  - POST:
      endpoint: /wmb/trip/link
      auth: TokenAuth PROVIDER_TYPE
      request:
        type: TripLinkReq
      response:
        type: TripTransactionDetails

  - GET:
      endpoint: /wmb/trip/active
      auth: TokenAuth PROVIDER_TYPE
      response:
        type: ActiveTripTransaction

  - GET:
      endpoint: /wmb/trip/list
      auth: TokenAuth PROVIDER_TYPE
      query:
        - limit: Int
        - offset: Int
        - status: TripStatus
      response:
        type: "[TripTransactionDetails]"

  - POST:
      endpoint: /wmb/trip/{tripTransactionId}/start
      auth: TokenAuth PROVIDER_TYPE
      params:
        tripTransactionId: Text
      request:
        type: TripStartReq
      response:
        type: APISuccess

  - POST:
      endpoint: /wmb/trip/{tripTransactionId}/end
      auth: TokenAuth PROVIDER_TYPE
      params:
        tripTransactionId: Text
      request:
        type: TripEndReq
      response:
        type: TripEndResp

  - POST:
      endpoint: /wmb/trip/{tripTransactionId}/request
      auth: TokenAuth PROVIDER_TYPE
      params:
        tripTransactionId: Text
      request:
        type: RequestDetails
      response:
        type: DriverReqResp
  - POST:
      endpoint: /wmb/requests/{driverRequestId}/cancel
      auth: TokenAuth PROVIDER_TYPE
      params:
        driverRequestId: Text
      response:
        type: APISuccess
