imports:
  # FareParameters: Domain.Types.FareParameters
  # FarePolicy: Domain.Types.FarePolicy
  # TripCategory: Domain.Types.Common
  # Variant: Domain.Types.Vehicle
  # SearchRequest: Domain.Types.SearchRequest
  Booking: Domain.Types.Booking.Type
  Merchant: Domain.Types.Merchant
  MerchantOperatingCity: Domain.Types.MerchantOperatingCity
  Price: Kernel.Types.Common
  # Money: Kernel.Types.Common


BookingUpdateRequest:
  tableName: booking_update_request
  # derives: "Generic,Show, "
  types:
    BookingUpdateRequestStatus:
      enum: "SOFT,CONFIRM"
      derive: "HttpInstance"

  beamInstance: MakeTableInstancesWithTModifier []

  fields:
    id: Id BookingUpdateRequest
    bookingId: Id Booking
    status: BookingUpdateRequestStatus
    travelledDistance: Maybe HighPrecMeters
    estimatedDistance : Maybe HighPrecMeters
    estimatedFare : Maybe HighPrecMoney
    totalDistance : Maybe HighPrecMeters
    currentPointLat : Maybe Double
    currentPointLon : Maybe Double
    oldEstimatedFare : HighPrecMoney
    oldEstimatedDistance : Maybe HighPrecMeters
    createdAt: UTCTime
    updatedAt: UTCTime
    merchantId: Id Merchant
    merchantOperatingCityId: Id MerchantOperatingCity

    # excludedFields:
    #   - merchantId
    #   - merchantOperatingCityId

    # beamFields:
    #   farePolicy:
    #     farePolicyId: Maybe Text

    # sqlType:
    #   farePolicyId: character varying(36)
    # beamType:
    #   updatedAt: Maybe UTCTime
    #   isScheduled: Maybe Bool
    #   tripCategory: Maybe TripCategory

    # fromTType:
    #   updatedAt: Kernel.Prelude.fromMaybe createdAt|I
    #   isScheduled: Kernel.Prelude.fromMaybe Kernel.Prelude.False|I
    #   tripCategory: Kernel.Prelude.fromMaybe (Domain.Types.Common.OneWay Domain.Types.Common.OneWayOnDemandDynamicOffer)|I
    #   farePolicy: maybe (pure Nothing) ((Storage.CachedQueries.FarePolicy.findById Nothing Nothing) . Kernel.Types.Id.Id)|IM


    # toTType:
    #   updatedAt: Kernel.Prelude.Just|I
    #   isScheduled: Kernel.Prelude.Just|I
    #   tripCategory: Kernel.Prelude.Just|I
    #   farePolicyId: (Kernel.Types.Id.getId . (.id) <$>)

  queries:
    findById:
      kvFunction: findOneWithKV
      where:
        and: [id]
    findAllByBookingId:
      kvFunction: findAllWithKV
      where:
        and: [bookingId]
    updateMultipleById:
      kvFunction: updateOneWithKV
      params: [travelledDistance, estimatedDistance, estimatedFare, totalDistance, currentPointLat, currentPointLon, updatedAt]
      where: id
    updateStatusById:
      kvFunction: updateOneWithKV
      params: [status, updatedAt]
      where: id