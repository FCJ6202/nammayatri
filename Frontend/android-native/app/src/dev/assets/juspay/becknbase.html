<html>
<head>
    <title>BECKN - DEV</title>
</head>
<body>
</body>
<script type="text/javascript">
	console.log("becknbase.html start")
	window.timeFunc = {}
	window.timeFunc.becknbase = Date.now();
    window.__OS = "ANDROID";
    window.JBridge = top.JBridge;
    window.Android = top.Android;
    window.DUIGatekeeper = JBridge;
	window.onFileUpdated = function (){
      console.log("arguments -=>", arguments)
    //   JBridge.toast("GOT UPDATE");
      if ((arguments[0].includes("v1-index_bundle.zip")) && ((arguments[0].includes("in.juspay.nammayatri")) || (arguments[0].includes("in.juspay.nammayatripartner"))) ){
        JBridge.toast("BUNDLE UPDATE AVAILABLE");
        JBridge.runInJuspayBrowser("onEvent", JSON.stringify({
            event: "reboot",
            service: "in.juspay.nammayatri",
            payload: {},
            error: false,
            errorMessage: "",
            errorCode: ""
          }), "");
        console.log("arguments after -=>", arguments)
      }

    }
    window.JOS.addEventListener("onFileUpdated")();

</script>

<script type="text/javascript">
    var ip = DUIGatekeeper.getResourceByName("local_ip");
    var port = DUIGatekeeper.getResourceByName("dev_port");
    port = port ? port : "8080";
    var url = "http://" + "192.168.101.235" + ":" + port;
    var headID = document.getElementsByTagName("head")[0];
    var newScript = document.createElement('script');
    newScript.type = 'text/javascript';
    newScript.id = 'socket';
	newScript.innerHTML = DUIGatekeeper.loadFileInDUI('index_bundle.js');
    newScript.src = url + '/dist/index_bundle.js';
	console.log("new script index_bundle", newScript);
    headID.appendChild(newScript);


	// var url = "http://" + "192.168.1.36" + ":" + "8082";
    // var newScript2 = document.createElement('script');
    // newScript2.type = 'text/javascript';
    // // newScript.id = 'socket';
	// newScript2.innerHTML = JBridge.loadFileInDUI('1.index_bundle.js');
    // newScript2.src = url + '/dist/1.index_bundle.js';
	// console.log("1.index_bundle.js script", newScript2.innerHTML);
    // headID.appendChild(newScript2);

    // console.log("head", headID);

</script>
<!--
<script type="text/javascript">
    var ip = DUIGatekeeper.getResourceByName("local_ip");
    var port = DUIGatekeeper.getResourceByName("dev_port");
    port = port ? port : "8080";
    var url = "http://" + ip + ":" + port;
	var reloadApp = function() {
		console.log("Reloading app")
		var headID = document.getElementsByTagName("head")[0];
        var newScript = document.createElement('script');
        newScript.type = 'text/javascript';
        newScript.id = 'mystique';
        newScript.src = url + '/dist/index_bundle.js';
        headID.appendChild(newScript);
        console.log("URL 2 ===>", url + '/dist/index_bundle.js');
	}
	var currentHash = null
	var onSocketMsg = {
		"hot": function() {
			console.log("hot");
		},
		"invalid": function() {
			console.log("App updated. Recompiling...");
		},
		"hash": function(hash) {
			currentHash = hash;
			console.log(hash);
		},
		"still-ok": function() {
			console.log("App ready.");
		},
		"ok": function() {
			console.log("It is ok");
			reloadApp();
		},
		"warnings": function(warnings) {
			console.log("Warnings while compiling.");
			reloadApp();
		},
		"errors": function(errors) {
			console.log("App updated with errors. No reload!");

			if (Android)
			    Android.throwError(errors[0]);
		},
		"proxy-error": function(errors) {
			console.log("Could not proxy to content base target!");

			if (Android)
			    Android.throwError(errors[0]);
		},
		"close": function() {
			console.log("Disconnected.");
		},
		"log-level": function(){
		}
	}
	window.onload = function() {
	    var sock = new SockJS(url + '/sockjs-node');
		sock.onopen = function() {
		   console.log('open');
		};
		sock.onmessage = function(e) {
		  var msg = JSON.parse(e.data);
		  if(typeof onSocketMsg[msg.type] == "function")
		    onSocketMsg[msg.type](msg.data)
		};
		sock.onclose = function() {
		   console.log('close');
		};
	}
</script> -->
</html>