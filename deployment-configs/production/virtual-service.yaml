apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: atlas-vs
  namespace: atlas
spec:
  gateways:
  - atlas-internal
  hosts:
  - '*'
  http:
  - match:
    - uri:
        prefix: /map/grphr/
    rewrite:
      uri: /
    route:
    - destination:
        host: graphhopper
        port:
          number: 8989
    timeout: 40s
  - match:
    - uri:
        prefix: /dunzo/
    rewrite:
      uri: /
    route:
    - destination:
        host: beckn-fmd-wrapper-083-production
        subset: 039dad9d
      weight: 100
    timeout: 40s
  - match:
    - headers:
        authorization:
          prefix: Signature
      uri:
        prefix: /gateway/
    rewrite:
      uri: /
    route:
    - destination:
        host: beckn-gateway-production
        port:
          number: 8015
        subset: $BUILD_VERSION
      weight: 100
    timeout: 40s
  - match:
    - uri:
        prefix: /gateway/
    rewrite:
      uri: /
    route:
    - destination:
        host: beckn-gateway-083-production
        port:
          number: 8015
        subset: 039dad9d
      weight: 100
    timeout: 40s
  - match:
    - uri:
        prefix: /app/support/
    - uri:
        prefix: /app/support
    rewrite:
      uri: /
    route:
    - destination:
        host: beckn-app-customer-support-production
        port:
          number: 3000
    timeout: 40s
  - match:
    - uri:
        prefix: /app/
    rewrite:
      uri: /
    route:
    - destination:
        host: beckn-app-backend-production
        port:
          number: 8013
        subset: $BUILD_VERSION
      weight: 100
    timeout: 40s
  - match:
    - uri:
        prefix: /transport/
    rewrite:
      uri: /
    route:
    - destination:
        host: beckn-transport-production
        port:
          number: 8014
        subset: $BUILD_VERSION
      weight: 100
    timeout: 40s
  - match:
    - uri:
        prefix: /bap/
    rewrite:
      uri: /
    route:
    - destination:
        host: beckn-app-backend-production
        port:
          number: 8013
        subset: $BUILD_VERSION
      weight: 100
    timeout: 40s
  - match:
    - uri:
        prefix: /bpp/metro/
    rewrite:
      uri: /
    route:
    - destination:
        host: beckn-kmrl
        port:
          number: 8000
      weight: 100
    timeout: 40s
  - match:
    - uri:
        prefix: /bpp/cab/
    rewrite:
      uri: /
    route:
    - destination:
        host: beckn-transport-production
        port:
          number: 8014
        subset: $BUILD_VERSION
      weight: 100
    timeout: 40s
