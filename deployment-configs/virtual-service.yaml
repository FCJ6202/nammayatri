apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: atlas-vs
  namespace: atlas
spec:
  gateways:
    - atlas-internal
  hosts:
    - api.sandbox.beckn.juspay.in
  http:
    - match:
        - uri:
            prefix: /map/otp/
      rewrite:
        uri: /
      route:
        - destination:
            host: otp-api
            port:
              number: 8080
      timeout: 40s
    - match:
        - uri:
            prefix: /otp/
      route:
        - destination:
            host: otp-api
            port:
              number: 8080
      timeout: 40s
    - match:
        - uri:
            prefix: /map/grphr/
      rewrite:
        uri: /
      route:
        - destination:
            host: graphhopper
            port:
              number: 8989
      timeout: 40s
    - match:
        - uri:
            prefix: /maps/
        - uri:
            prefix: /info
        - uri:
            prefix: /i18n/
        - uri:
            prefix: /route
      route:
        - destination:
            host: graphhopper
            port:
              number: 8989
      timeout: 40s
    - match:
        - uri:
            prefix: /app/support/
        - uri:
            prefix: /app/support
      rewrite:
        uri: /
      route:
        - destination:
            host: beckn-app-customer-support-sandbox
            port:
              number: 3000
      timeout: 40s
    - match:
        - uri:
            prefix: /app/
      rewrite:
        uri: /
      route:
        - destination:
            host: beckn-app-backend-sandbox
            port:
              number: 8013
      timeout: 40s
    - match:
        - uri:
            prefix: /transport/
      rewrite:
        uri: /
      route:
        - destination:
            host: beckn-transport-sandbox
            port:
              number: 8014
      timeout: 40s
    - match:
        - uri:
            prefix: /fmd/
      rewrite:
        uri: /
      route:
        - destination:
            host: beckn-fmd-wrapper-083-sandbox
            port:
              number: 8018
      timeout: 40s
    - match:
        - headers:
            authorization:
              prefix: Signature
          uri:
            prefix: /gateway/
      rewrite:
        uri: /
      route:
        - destination:
            host: beckn-gateway-sandbox
            port:
              number: 8015
      timeout: 40s
    - match:
        - uri:
            prefix: /gateway/
      rewrite:
        uri: /
      route:
        - destination:
            host: beckn-gateway-083-sandbox
            port:
              number: 8015
      timeout: 40s
    - match:
        - uri:
            prefix: /dev/app/
      rewrite:
        uri: /
      route:
        - destination:
            host: beckn-app-backend-master
            port:
              number: 8013
    - match:
        - uri:
            prefix: /dev/transport/
      rewrite:
        uri: /
      route:
        - destination:
            host: beckn-transport-master
            port:
              number: 8014
      timeout: 40s
    - match:
        - uri:
            prefix: /dev/gateway/
      rewrite:
        uri: /
      route:
        - destination:
            host: beckn-gateway-master
            port:
              number: 8015
      timeout: 40s
    - match:
        - uri:
            prefix: /dev/fmd/
      rewrite:
        uri: /
      route:
        - destination:
            host: beckn-fmd-wrapper-master
            port:
              number: 8018
      timeout: 40s
